<!DOCTYPE html>

<html>
<head>
  <title></title>
  <style type="text/css">
  body {
    margin: 2.0em auto;
    max-width: 50em;
    background-color: rgb(246,243,244) ;
    color: rgb(16,24,32);
    font-size: 1.0em;
    font-family: 'Helvetica Neue', Verdana, Arial, sans-serif;
  }
  @media ( max-width: 54em ) {
    body {margin: 2.0em 2.0em;}
  }
  p, dl { line-height: 1.1875em; }

  dd { margin-bottom: 1.0em; }
  dd p { margin-top: 0; }
  dl.inline-terms {
    border-bottom: 1px solid rgba(16,24,32,0.125);
    border-top: 1px solid rgba(16,24,32,0.125);
  }
  dl.inline-terms dt {
    float: left;
    clear: left;
    width: 8.5em;
    text-align: right;
    padding-right: 0.5em;
    padding-top: 0.325em;
    padding-bottom: 0.375em;
  }
  dl.inline-terms dt::after {
    content: " : ";
  }
  dl.inline-terms dd {
    margin-left: 9.0em;
    padding-top: 0.375em;
    padding-bottom: 0.375em;
    border-top: 1px solid rgba(16,24,32,0.125);
  }
  dl.inline-terms dd:first-of-type {
    border-top: none;
  }
  ul#jumpto { margin-left: 0em; padding-left: 0em;  }
  ul#jumpto ul { margin-left: 0.75em; padding-left: 0.75em;  }
  ul#jumpto li {
    font-weight: bold;
    margin-bottom: 0.75em;
    color: #000099;
    list-style-type: none;

  }
  ul#jumpto li a {
    text-decoration: none;
    color: #000099;
  }
  ul#jumpto li li {
    font-weight: normal;
    margin-bottom: 0.25em;
    list-style-type: circle;
  }
  code { font-size: 1.25em; }
  pre {
    font-size: 1.0625em;
    border-left: 0.25em solid rgba(16,24,32,0.25);
    padding: 0.75em;
    background-color: rgba(16,24,32,0.0625)
   }
  </style>
</head>
<body>

<!-- *** BEGIN CONTENT *** *************************************** -->
<h1>Minor-Key docs</h1>

<div id="contents">

<h2 id="toc-links">Contents</h2>

<h2>Code organization</h2>

<p>These are the basic rules set out for writing code for this application.</p>

<p>The standards are kept pretty loose, but should be adhered to.</p>

<h3 class="add-toc">Component separation and processing order</h3>

<p>All core code has been written with the unidirectional flow described below. You can iterate, but not move backwards.</p>

<p>Direction of flow is enforced by encapsulation and an expection that a particular type of object will be passed each step of the way. Core files will include the following strings to indicate what part of the process they are involved with.</p>

<p>Request evaluation and computation:</p>
<dl class="inline-terms">
  <dt id="dfn-process-init">init</dt><dd>Initialize core.</li></dd>
  <dt id="dfn-process-grab">grab</dt><dd>Retrieve requests and accompanying data.</dd>
  <dt id="dfn-process-proc">proc</dt><dd>Process request data and gather response data.</dd>
</dl>

<p>Response assembly and presentation:</p>
<dl class="inline-terms">
  <dt id="dfn-process-prep">prep</dt><dd>Use the template to prepare response for presentation</dd>
  <dt id="dfn-process-send">send</dt><dd>Send response</dd>
</dl>

<!-- *** NAMING CONVENTIONS *** ********************************** -->
<h3 class="add-toc">Naming conventions</h3>

<p>Minor-Key uses prefixes to designate namespaces reserved for use by core and to designate certain categories of variables. These prefexes are broken out by what they label.</p>

<p>Reserved prefixes:</p>
<dl class="inline-terms">
  <dt id="dfn-prefix-mk">mk_</dt><dd>General use to clarify files and directories as part of the minor-key code base.</dd>
  <dt id="dfn-prefix-mkk">MK_</dt><dd>Constants defined by core.</dd>
  <dt id="dfn-prefix-mkc">mkc_</dt><dd>Class definitions. There may be a fourth letter to specify specific the nature of the class definition.</dd>
  <dt id="dfn-prefix-mkf">mkf_</dt><dd>Functions. All public core functions are prefixed with <b>mkf_</b></dd>
  <dt id="dfn-prefix-mko">mko_</dt><dd>Object instances. All instantiated core objects should be prefixed with <b>mko_</b>.</dd>
  <dt id="dfn-prefix-mkv">mkv_</dt><dd>Variables. Most public core variables are prefixed with <b>mkv_</b>.</dd>
  <dt id="dfn-prefix-mkv">mkt_</dt><dd>Template settings.</dd>
  <dt id="dfn-prefix-mkpre">mkpre_</dt><dd>User defined functions to run before a core function of the same name. Not all functions support this.</dd>
  <dt id="dfn-prefix-mkpost">mkpost_</dt><dd>User defined functions to run after a core function of the same name. Not all functions support this.</dd>
  <dt id="dfn-prefix-mkpost">DEF_</dt><dd>Site specific default constants. These should only be set in <b>init.php</b> or the template-specific equivalent.</dd>
  <dt id="dfn-prefix-mkpost">temp_</dt><dd>Temporary variables. They should be assumed to contain garbage and should never be used across more than a few lines of code.</dd>
  <dt id="dfn-prefix-mkpost">t_</dt><dd>Temporary variables. They should be assumed to contain garbage and should never be used across more than a few lines of code.</dd>
</dl>

<!-- *** COMMENT STLYES *** ************************************** -->

<h3 class="add-toc">Commenting the code</h3>

<p>Minor-Key uses multiple types of commments, depending on function:</p>
<dl class="inline-terms">
  <dt id="dfn-comments-block">simple block</dt>
  <dd>
    A basic block or multiline comment uses slashterisk notation.
    <pre>/*<br /> * Some long decription<br /> */</pre>
  </dd>
  <dt id="dfn-comments-block">PHPDoc</dt>
  <dd>
    A comment block that documents how functions or objects work, or catalogs the contents of the current file, uses the modified slashterisk format to conform to PHPDoc standard. This allows PHPDoc-aware editors to color code keywords in the comments, as well as allowing a PHPDoc parser to generate documentation from the comments.
    <pre>/**<br />  * Some long decription<br />  */</pre>
  </dd>
  <dt id="dfn-comments-block">inline</dt>
  <dd>
    Inline comments beign with a hash mark: <code>#</code>. This is to differentiate it from commented-out code.
    <pre># inline comment</pre>
    For section breaks, or to call out a comment, a dashed line is used with an asterisk in the last column to make it easier to scan for comments.
    <pre># Do some new stuff -------------------------------------------------- *</pre>
  </dd>
  <dt id="dfn-comments-block">inactive code</dt>
  <dd>
    Code is commented out with a double slash <code>//</code>. This is the default in PHP, so if you use hot keys to comment out blocks of code, it is what you will get.
    <pre>// echo testvar;</pre>
  </dd>
</dl>

<!-- *** OBJECTS *** ********************************************* -->
<h2>Objects</h2>

<p>Minor Key uses objects for tracking various page components and some of the site settings. This is to make the code easier to use and to allow for automated validation of various elements.</p>

<!-- *** menu object *** *************************************** -->
<h3 class="add-toc">mkc_menus</h3>

<p>The <cite>menu</cite> object stores the menu sets for a page.</p>

<p>Except for instantiation, method calls to the menus object always return arrays. The return array will have the following stucture:</p>

<dl>
  <dt><code>results['success'] bool</code></dt>
  <dd>
    <p>Returns true on success, false on an error.</p>
  </dd>
  <dt><code>results['content'] string | array</code></dt>
  <dd>
    <p>If there was an error, this will contain the error message associated with the reference code above. Otherwise it will return the string or array containing the returned values.</p>
  </dd>
</dl>

<p>At present, there is no functionality to remove menus or links from the menus object. Rather, return values are filtered by permission settings.</p>

<h4>Constructor</h4>

<pre>mkc_menus( [bool $is_locked=true] );</pre>

<p>Use <code>$is_locked</code> to specify existing values as immutable. This allows later scripts to add new menus and add new links to menus, but not change the attributes of existing links or menus.</p>

<p>It is set to <code>true</code> by default.</p>

<h4>Create a new menu</h4>

<p>If a menu and its menu set is not locked, this method can be used to reset a menu.</p>

<pre>mko_menus->setmenu( str $name  [, array $settings] );</pre>

<p>Properties:</p>

<dl>
<dt><code>params['is_locked'] bool = false</code></dt>
  <dd><p>A menu can be locked spearately from the menu set. Setting this to false will not override a parent setting of true.</p></dd>
<dt><code>params['permissions'] string = 'public'</code></dt>
  <dd>
    <p>A space separated string of permission levels for this menu. These are restrictive values. The string must be provided when generating the menu or the menu is blocked. The value of 'public' is a placeholder and is ignored by the code. Current permission levels are:</p>
    <ul>
      <li>public</li>
      <li>internal</li>
      <li>editor</li>
      <li>pio</li>
      <li>admin</li>
    </ul>
  </dd>
<dt><code>params['type'] string = 'left-sidebar'</code></dt>
  <dd>A template specific description of the function this menu serves. Most commonly, its location on the page.</dd>
<dt><code>param['classes'] string = ''</code></dt>
  <dd>A space separated list of classes to be added to the container element when generating the menu.</dd>
</dl>

<h4>Create or edit a link</h4>

<pre>mko_menus->setlink( str $menu, string $text, str $url [, array $settings] );</pre>

<h4>Change a menu property</h4>

<pre>mko_menus->setmenuprop( str $menu, str $property, str $value );</pre>

<h4>Change a link property</h4>

<pre>mko_menus->setlinkprop( str $menu, str $text, str $property, str $value );</pre>

<h4>Return a menu as an HTML list</h4>

<pre>mko_menus->getmenu( str $name [, array $settings ] );</pre>

<h4>Return a menu as an array</h4>

<pre>mko_menus->getlist( str $name [, array $settings ] );</pre>

<h4>Return the properties of a menu</h4>

<pre>mko_menus->getmenuprop( str $menu, str $property );</pre>

<h4>Return the properties of a link</h4>

<pre>mko_menus->getlink( str $menu, str $text [, array $settings] );</pre>

<!-- *** parts object *** **************************************** -->
<h3 class="add-toc">mkc_parts</h3>

<p>The <cite>parts</cite> object contains information fields for a page as well as a content blob.</p>

<p>It can also be used recursively for page components.</p>

<!-- *** paths object *** **************************************** -->
<h3 class="add-toc">mkc_paths</h3>

<p>The <cite>paths</cite> object stores internal paths for PHP use. This is to allow paths to be defined up front and then called from the object. This reduces typos and inconsistencies</p>

<p>If a path is hard-coded in the process code instead of being defined in the config or init files, you did something wrong.</p>
</div>
<!-- *** end contents *** **************************************** -->

<script type="text/javascript" src="../vendors/jquery/jquery-3.2.1.min.js"></script>
<script type="text/javascript" src="../_assets/js/toc-generator.js"></script>
</body>
</html>
